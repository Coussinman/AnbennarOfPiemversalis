rubyhold_tree_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = A20
	}

	A20_rubyhold_empire = {
		icon = mission_unite_home_region
		position = 1
		required_missions = { }
		provinces_to_highlight = { 
            owned_by = emperor
		}
		trigger = {
            emperor = {
				has_opinion = {
					who = ROOT
					value = 150
				}
			}
            diplomatic_reputation = 3
            statesman = 3
		}
		effect = { 
            A20 = {
                set_in_empire = yes
            }
		}
	}

	A20_rubyhold_vs_silverforge = {
		icon = mission_unite_home_region
		position = 2
		required_missions = {
			A20_rubyhold_empire
		}
		provinces_to_highlight = {
            owned_by = A73
        }
		trigger = {
            OR = {
                AND = {
                    A73 = {
                        has_spy_network_from = {
                            who = ROOT
                            value = 75
                        }
                        OR = {
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = insulted
                            }
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = scornfully_insulted
                            }
                        }
                    }
                    alliance_with = emperor
                }
                A73 = { exists = no }
            }
        }
		effect = {
            if = {
                limit = { A73 = { exists = yes } }
                add_casus_belli = {
                    type = cb_vassalize_mission
                    months = 1200
                    target = A73
                }
            }
        }
	}

	A20_end_of_rivalry = {
		icon = mission_unite_home_region
		position = 3
		required_missions = {
			A20_rubyhold_vs_silverforge
		}
		provinces_to_highlight = { 
            owned_by = A73
        }
		trigger = {
            OR = {
                A73 = {
                    is_subject_of = A20  
                }
                A73 = { exists = no }
            }
        }
		effect = {
            if = {
                limit = { A73 = { exists = yes } } 
                A73 = {
                        elector = no
                    }
                A20 = {
                    elector = yes
                }
            }
        }
	}

	A20_rubyhold_institute = {
		icon = mission_unite_home_region
		position = 4
		required_missions = { }
		provinces_to_highlight = { 
            province_id = 62
        }
		trigger = { 
            62 = {
                has_great_project = {
                    type = rubyhold_academy
                    tier = 1
                }
            }
        }
		effect = { 
            62 = {
                add_province_modifier = {
                    name = build_help
                    duration = -1
                }
            }
        }
	}

	A20_race_studies = {
		icon = mission_unite_home_region
		position = 5
		required_missions = {
			A20_rubyhold_institute
		}
		provinces_to_highlight = { 

        }
		trigger = {
            any_country ={
                culture_group = halfling
                has_opinion = {
					who = ROOT
					value = 125
				}
                has_spy_network_from = {
                    who = ROOT
                    value = 25
                }
            }
            any_country ={
                culture_group = gnomish
                 has_opinion = {
					who = ROOT
					value = 125
				}
                has_spy_network_from = {
                    who = ROOT
                    value = 25
                }
            }
            any_country ={
                culture_group = elven 
                 has_opinion = {
					who = ROOT
					value = 125
				}
                has_spy_network_from = {
                    who = ROOT
                    value = 25
                }
            }
        }
		effect = { 
            62 = {
                add_gnomish_minority_size_effect = yes
                add_halfling_minority_size_effect = yes
                add_half_elven_minority_size_effect = yes
                add_elven_minority_size_effect = yes
            }
        }
	}

	A20_multirace_institute = {
		icon = mission_unite_home_region
		position = 6
		required_missions = {
			A20_race_studies
		}
		provinces_to_highlight = { }
		trigger = {
			OR = {
				has_great_project = {
					type = rubyhold_academy
					tier = 2
           		}
				has_great_project = {
					type = rubyhold_academy
					tier = 3
           		}
			}
            high_tolerance_gnomish_race_trigger = yes
            high_tolerance_halfling_race_trigger = yes
            high_tolerance_half_elven_race_trigger = yes
            high_tolerance_elven_race_trigger = yes
        }
		effect = {
            A20 = {
                change_innovativeness = 5
            }
            62 = {
                add_province_modifier = {
                    name = multirace_institute_md
                    duration = -1
                }
            }
        }
	}

	A20_anbenncost_rival = {
		icon = mission_unite_home_region
		position = 7
		required_missions = {
			A20_multirace_institute
		}
		provinces_to_highlight = { }
		trigger = { 
            62 = {
                development = 80
                num_free_building_slots = 0
                 has_great_project = {
                    type = rubyhold_academy
                    tier = 3
                }
            }
            diplomatic_reputation = 4
            stability = 3
        }
		effect = { 
            62 = {
                add_province_modifier = {
                    name = rubyhold_surpass_abenncost
                    duration = -1
                }
            }
        }
	}

	A20_hold_of_the_world_desire = {
		icon = mission_unite_home_region
		position = 8
		required_missions = {
			A20_anbenncost_rival
		}
		provinces_to_highlight = { }
		trigger = {
            capital_scope = {
			    has_dwarven_hold_11 = yes
				custom_trigger_tooltip = {
					tooltip = rubyhold_no_other_province_higher_dev_tt
					NOT = {
						any_province = {
							higher_development_than = PREV
						}
					}
				}
			}
        }
		effect = {
            if = {
                limit = {
                    has_dlc = "Mandate of Heaven"
                }
                custom_tooltip = ARB_golden_age_renewal_tt
                hidden_effect = {
                    if = {
                        limit = { has_had_golden_age = yes } 
                        reset_golden_age = yes 
                    }
                    else_if = {
                        limit = { in_golden_age = yes } 
                        extend_golden_age = 600
                    }
                }
                custom_tooltip = " "
            }
        }
	}
}
rubyhold_tree_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = A20

	}

	A20_rosemetal_mines = {
		icon = mission_unite_home_region
		position = 3
		required_missions = {
			A20_hold_1
		}
		provinces_to_highlight = { province_id = 4241 }
		trigger = {
			4241 = {
				base_production = 10
				has_building = workshop
				has_manufactory_trigger = yes
			}
		}
		effect = {
            4241 = {
                add_province_modifier = {
                    name = build_help
                    duration = 3650
                }
            }
        }
	}

	A20_find_purest_ruby = {
		icon = mission_unite_home_region
		position = 4
		required_missions = {
			A20_rosemetal_mines
		}
		provinces_to_highlight = { province_id = 4241 }
		trigger = { 
			4241 = {
				has_great_project = {
                    type = rosemetal_mines
                    tier = 3
                }
			}
		}
		effect = { 
			4343 = {
				add_province_modifier = {
					name = searching_purest_ruby
					duration = 7300
				}
			}
		}
	}

	A20_backlash = {
		icon = mission_unite_home_region
		position = 5
		required_missions = {
			A20_find_purest_ruby
		}
		provinces_to_highlight = { province_id = 4343 }
		trigger = { 
			4343 = {
				NOT = { has_province_modifier = searching_purest_ruby }
			} 
		}
		effect = { 
			4343 = {
				add_province_modifier = {
					name = ruby_madness
					duration = -1
				}
			}
		}
	}

	A20_request_help = {
		icon = mission_unite_home_region
		position = 6
		required_missions = {
			A20_backlash
		}
		provinces_to_highlight = { 
			any_country = { culture_group = gnomish }
			any_country = { culture_group = dwarven }  
		}
		trigger = {
			treasury = 2000
			diplomatic_reputation = 3
			4343 = {
				base_production = 7
			}
			AND = {
				any_country = {
                    culture_group = gnomish
                    has_opinion = {
                        who = ROOT
                        value = 125
                    }
            	}
				any_country = {
                    culture_group = dwarven
                    has_opinion = {
                        who = ROOT
                        value = 125
                    }
            	}
            }
        }
		effect = {
			add_treasury = -2000 
			4343 = {
				add_province_modifier = {
					name = expert_digger_team
					duration = 3650
				}
				add_gnomish_minority_size_effect = yes
			}
			A20 = {
				large_increase_of_gnomish_tolerance_effect = yes
			}
			hidden_effect = {
				4343 = {
					spawn_rebels = {
						size = 3
						type = MJ_rebels	
					}
					add_devastation = 100
					add_base_tax = -3
					add_base_production = -3
					add_base_manpower = -3
					remove_all_buildings = yes
				}
			}		
		}
	}

	A20_end_of_despair = {
		icon = mission_unite_home_region
		position = 7
		required_missions = {
			A20_request_help
		}
		provinces_to_highlight = { province_id = 4343 }
		trigger = { 
			4343 = {
				NOT = { has_province_modifier = expert_digger_team }
		 	}
			OR = {
				has_country_modifier = magic_estate_scrying_internal_dissidents_1
				has_country_modifier = magic_estate_scrying_internal_dissidents_2
				has_country_modifier = magic_estate_scrying_internal_dissidents_3
			}
		}
		effect = { 
			4343 = {
				remove_province_modifier = ruby_madness
				add_province_modifier = {
					name = location_of_the_red_light_of_anbennar
					duration = -1
				}
			}
		}
	}
}
rubyhold_tree_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = A20

	}

	A20_ruby_mountains = {
		icon = mission_unite_home_region
		position = 1
		required_missions = { }
		provinces_to_highlight = { province_id = 62 }
		trigger = { 
            62 = {
                development = 30
            }
        }
		effect = { 
            62 = {
                add_province_modifier = {
                    name = hold_boost_1
                    duration = -1
                }
            }
        }
	}

	A20_hold_1 = {
		icon = mission_unite_home_region
		position = 2
		required_missions = {
			A20_ruby_mountains
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_3 = yes
            } 
        }
		effect = { 
            62 = {
                remove_province_modifier = hold_boost_1
                add_province_modifier = {
                    name = hold_boost_2
                    duration = -1
                }
            }
        }
	}

	A20_hold_2 = {
		icon = mission_unite_home_region
		position = 3
		required_missions = {
			A20_hold_1
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_4 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_2
                add_province_modifier = {
                    name = hold_boost_3
                    duration = -1
                }
            }
         }
	}

	A20_hold_3 = {
		icon = mission_unite_home_region
		position = 4
		required_missions = {
			A20_hold_2
		}
		provinces_to_highlight = { province_id = 62}
		trigger = {
            62 = {
                has_dwarven_hold_5 = yes
            } 
        }
		effect = { 
            62 = {
                remove_province_modifier = hold_boost_3
                add_province_modifier = {
                    name = hold_boost_4
                    duration = -1
                }
            }
        }
	}

	A20_hold_4 = {
		icon = mission_unite_home_region
		position = 5
		required_missions = {
			A20_hold_3
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_6 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_4
                add_province_modifier = {
                    name = hold_boost_5
                    duration = -1
                }
            }
        }
	}

	A20_hold_5 = {
		icon = mission_unite_home_region
		position = 6
		required_missions = {
			A20_hold_4
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_7 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_5
                add_province_modifier = {
                    name = hold_boost_6
                    duration = -1
                }
            }
         }
	}

	A20_hold_6 = {
		icon = mission_unite_home_region
		position = 7
		required_missions = {
			A20_hold_5
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = { 
            62 = {
                has_dwarven_hold_8 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_6
                add_province_modifier = {
                    name = hold_boost_7
                    duration = -1
                }
            }
         }
	}

	A20_hold_7 = {
		icon = mission_unite_home_region
		position = 8
		required_missions = {
			A20_hold_6
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_9 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_7
                add_province_modifier = {
                    name = hold_boost_8
                    duration = -1
                }
            }
         }
	}

	A20_hold_8 = {
		icon = mission_unite_home_region
		position = 9
		required_missions = {
			A20_hold_7
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_10 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_8
                add_province_modifier = {
                    name = hold_boost_9
                    duration = -1
                }
            }
         }
	}

	A20_hold_9 = {
		icon = mission_unite_home_region
		position = 10
		required_missions = {
			A20_hold_8
		}
		provinces_to_highlight = { province_id = 62 }
		trigger = {
            62 = {
                has_dwarven_hold_11 = yes
            } 
        }
		effect = {
            62 = {
                remove_province_modifier = hold_boost_9
                add_province_modifier = {
                    name = hold_boost_10
                    duration = -1
                }
            }
         }
	}
}
rubyhold_tree_4 = {
	slot = 4
	generic = no
	ai = yes 
	has_country_shield = yes
	potential = {
		tag = A20

	}

	A20_patron_of_the_citadels = {
		icon = mission_unite_home_region
		position = 2
		required_missions = {
			A20_ruby_mountains
		}
		provinces_to_highlight = { province_id = 8 }
		trigger = {
			treasury = 500 
			A38 = {
				has_opinion = {
					who = ROOT
					value = 125
				}
			}
			military_engineer = 2
		}
		effect = {
			add_treasury = -500 
			define_advisor = {
				name = "Dwarven WorkingProgressius"
				type = fortification_expert
				skill = 3
				cost_multiplier = 0.5
				#female = yes
				culture = ruby_dwarf
				religion = dwarven_pantheon
			}
		}
	}

	A20_architect_of_the_citadels = {
		icon = mission_unite_home_region
		position = 3
		required_missions = {
			A20_patron_of_the_citadels
		}
		provinces_to_highlight = { owned_by = A47 }
		trigger = { 
			treasury = 750 
			A38 = {
				has_opinion = {
					who = ROOT
					value = 125
				}
			}
			military_engineer = 3 
		}
		effect = { 
			add_treasury = -750
			64 = {
				add_province_modifier = {
					name = build_help
					duration = 7300
				}
			} 
			65 = {
				add_province_modifier = {
					name = build_help
					duration = 7300
				}
			}
		}
	}

	A20_twin_citadel = {
		icon = mission_unite_home_region
		position = 4
		required_missions = {
			A20_architect_of_the_citadels
		}
		provinces_to_highlight = { }
		trigger = { 
			treasury = 1500
			military_engineer = 4
		}
		effect = {
			64 = {
				add_province_modifier = {
					name = build_help
					duration = 7300
				}
			} 
			65 = {
				add_province_modifier = {
					name = build_help
					duration = 7300
				}
			}
			define_advisor = {
				name = "Dwarven WorkingEncorePlusInProgressius"
				type = fortification_expert
				skill = 5
				cost_multiplier = 0.1
				#female = yes
				culture = ruby_dwarf
				religion = dwarven_pantheon
			}
		}
	}

	A20_rose_seige_ing = {
		icon = mission_unite_home_region
		position = 6
		required_missions = {
			A20_learning_of_lillac_war
		}
		provinces_to_highlight = { }
		trigger = {
            has_global_modifier_value = {
                which = siege_ability
                value = 0.20
            }
        }
		effect = {
            62 = {
                add_province_modifier = {
                    name = rose_party_siege_engineers
                    duration = -1
                }
            }
        }
	}

	A20_tunnel_calculations = {
		icon = mission_unite_home_region
		position = 7
		required_missions = {
			A20_hold_5
		}
		provinces_to_highlight = { 
			province_id = 18
			province_id =  8 
			province_id = 912 
		}
		trigger = {
			treasury = 300 
			18 = {
				num_of_units_in_province = {
					amount = 1
					who = ROOT
				}
			}
			8 = {
				num_of_units_in_province = {
					amount = 1
					who = ROOT
				}
			}
			912 = {
				num_of_units_in_province = {
					amount = 1
					who = ROOT
				}
			}
		}
		effect = { 
			18 = {
				owner = {
					add_treasury = 100
				}
			}
			8 = {
				owner = {
					add_treasury = 100
				}
			}
			912 = {
				owner = {
					add_treasury = 100
				}
			}
		}
	}

	A20_digging_the_tunnel = {
		icon = mission_unite_home_region
		position = 8
		required_missions = {
			A20_tunnel_calculations
		}
		provinces_to_highlight = { province_id = 4232 }
		trigger = { 
			4232 = {
				num_of_units_in_province = {
					amount = 20
					who = ROOT
				}
			}
		}
		effect = { 
			4232 = {
				kill_units = {
					who = owner
				}
			}
			add_country_modifier = {
				name = digging_gempath_tunnel
				duration = 7300
			}
		}
	}

	A20_a_little_bit_offset = {
		icon = mission_unite_home_region
		position = 9
		required_missions = {
			A20_digging_the_tunnel
		}
		provinces_to_highlight = { 
			province_id = 2948 
			province_id = 4232 
		}
		trigger = { 
			NOT = { has_country_modifier = digging_gempath_tunnel }
		}
		effect = { 
			4232 = {
				add_canal = gempath_tunnel
			}
			4232 = {
				add_province_modifier = {
					name = gempath_tunnel_modifier
					duration = -1
				}
			}
			2948 = {
				add_province_modifier = {
					name = gempath_tunnel_modifier
					duration = -1
				}
				add_permanent_claim = ROOT
			}
			hidden_effect = {
				4232 = {
					spawn_rebels = {
						size = 2
						type = ancestor_worship_rebels
					}
					spawn_rebels = {
						size = 2
						type = ancestor_worship_rebels
					}
					spawn_rebels = {
						size = 2
						type = ancestor_worship_rebels
					}
					spawn_rebels = {
						size = 2
						type = ancestor_worship_rebels
					}
					spawn_rebels = {
						size = 2
						type = ancestor_worship_rebels
					}
				}
			}
		}
		
	}
}
rubyhold_tree_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = {
		tag = A20

	}

	A20_lencori_plan = {
		icon = mission_unite_home_region
		position = 1
		required_missions = { }
		provinces_to_highlight = { }
		trigger = {
            A01 = {
                has_spy_network_from = {
                    who = ROOT
                    value = 75
                }
            }
            has_leaders = {
                value = 1
                type = general
            }
            treasury = 200
        }
		effect = {
            if = {
                limit = { A01 = { exists = yes } }
                add_casus_belli = {
                    type = cb_vassalize_mission
                    months = 1200
                    target = A01
                }
            }
        }
	}

	A20_claim_ruby_crown = {
		icon = mission_unite_home_region
		position = 2
		required_missions = {
			A20_lencori_plan
		}
		provinces_to_highlight = { }
		trigger = { 
            OR = {
                A01 = {
                    is_subject_of = A20  
                }
                A01 = { exists = no }
            }
        }
		effect = { 
            62 = {
                add_province_modifier = {
                    name = ruby_crown
                    duration = -1
                }
            }
        }
	}

	A20_learning_of_lillac_war = {
		icon = mission_unite_home_region
		position = 5
		required_missions = { }
		provinces_to_highlight = { }
		trigger = {
            employed_advisor = {
                category = MIL
            }
            manpower_percentage = 1
            army_size_percentage = 1
        }
		effect = {
            A20={
                define_advisor = {
                    type = grand_captain
                    skill = 3
                    culture = root
                    religion = root
                    location = 62
                    cost_multiplier = 0.25
                }
            }
        }
	}

	A20_rosemetal_company = {
		icon = mission_unite_home_region
		position = 6
		required_missions = {
			A20_learning_of_lillac_war
		}
		provinces_to_highlight = { }
		trigger = { 
            estate_loyalty = {
					estate = estate_adventurers
					loyalty = 60
			}
            has_estate_privilege = estate_adventurers_free_company_rosters
			num_of_mercenaries = 1
            mil_power = 300
            mil_tech = 7
        }
		effect = {
            add_mil_power = -300
            62 = {
                add_province_modifier = {
                    name = rosemetal_engineers_company
                    duration = -1
                }
            }
            custom_tooltip = unlock_rosemetal_merc_tt
            hidden_effect = {
			    set_country_flag = unlock_rosemetal_merc
		    }
        }
	}

	A20_rosemetal_armor = {
		icon = mission_unite_home_region
		position = 7
		required_missions = {
			A20_rosemetal_company A20_rose_seige_ing
		}
		provinces_to_highlight = { province_id = 4241 }
		trigger = {
            mil_tech = 12
            4241 = {
				OR = {
				has_great_project = {
                    type = rosemetal_mines
                    tier = 2
                }
				has_great_project = {
                    type = rosemetal_mines
                    tier = 3
                }
				} 	
			}
            mil_power = 200
        }
		effect = {
            add_mil_power = -200
            4241 = {
                add_province_modifier = {
                    name = rose_metal_armor
                    duration = -1
                }
            }
        }
	}

	A20_stronbellow_academy = {
		icon = mission_unite_home_region
		position = 8
		required_missions = {
			A20_rosemetal_armor
		}
		provinces_to_highlight = { province_id = 912 }
		trigger = {
            912 = {
                has_great_project = {
                    type = silverforge_strongbellow_academy
                    tier = 3
                }
            }
        }
		effect = {
            62 = {
                add_province_modifier = {
                    name = strongbellow_academy
                    duration = -1
                }
            }
        }
	}

	A20_rosemetal_artillery = {
		icon = mission_unite_home_region
		position = 9
		required_missions = {
			A20_stronbellow_academy
		}
		provinces_to_highlight = { }
		trigger = {
            mil_tech = 16
            has_global_modifier_value = {
                which = artillery_power
                value = 0.30
            }
        }
		effect = { 
            62 = {
                add_province_modifier = {
                    name = rosemetal_artillery
                    duration = -1
                } 
            }   
        }
	}
}
